<!DOCTYPE html>
<meta charset="utf-8">

<!-- Load d3.js -->
<script src="https://d3js.org/d3.v4.js"></script>

<title>Homework #2: D3 Lollipop</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />
  
<body>
        <div class="container">
            <h1 class="text-center">Homework #2: D3 Lollipop</h1>
            <h3 class="text-center">Female vs Male employment rate in various countries</h3>
            <div class="row">
                <div class="col-1">Country: </div>
                <div class="col-3">
                    <!-- add your select here-->
                    <select name="countries" id="countries" style="max-width:100%;" onchange="tocall();">
                        <option value="United States">United States</option>
                        <option value="India">India</option>
                        <option value="Germany">Germany</option>
                        <option value="Afghanistan">Afghanistan</option>
                        <option value="Australia">Australia</option>
                    </select>
                </div>        
                </div>
         </div>
  </body>
    
<!-- Create a div where the graph will take place -->
<div id="my_dataviz"></div>


<script>

var clear = new Boolean(false);

function tocall(){
  d3.select("svg").remove();

  //d3.select("#my_dataviz").remove("svg");

  var e = document.getElementById("countries");
  var strUser = e.options[e.selectedIndex].text;
  console.log(strUser)

  // set the dimensions and margins of the graph
  var margin = {top: 10, right: 30, bottom: 50, left:150},
      width = 1000 - margin.left - margin.right,
      height = 600 - margin.top - margin.bottom;

  var counter = 0;

  // append the svg object to the body of the page
  var svg = d3.select("#my_dataviz")
    .append("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
    .append("g")
      .attr("transform",
            "translate(" + margin.left + "," + margin.top + ")");

  // Add X axis
  var x = d3.scaleLinear()
    .domain([1990, 2023])
    .range([ 0, width]);
  svg.append("g")
    .attr("transform", "translate(0," + height + ")")
    .call(d3.axisBottom(x).tickFormat(d3.format("d")))
    .selectAll("text")
      .attr("transform", "translate(-10,0)rotate(-45)")
      .style("text-anchor", "end");



  
  
  // Axis labels
  svg.append("text")
                .attr('class','axis-label')
                .attr('transform','rotate(-90)')
                .attr('y','-100px')
                .attr('x', -innerWidth/4)
                .attr('text-anchor','middle')
                .text('Employment Rate');

  svg.append("text")
                .attr('class','axis-label')
                .attr('text-anchor','middle')
                .attr('x','400px')
                .attr('y','590px')
                .text('Year');   

  svg.append("circle").attr("cx",'580px').attr("cy",'3px').attr("r", 6).style("fill", "Blue")
  svg.append("circle").attr("cx",'580px').attr("cy",'30px').attr("r", 6).style("fill", "Magenta")
  svg.append("text").attr("x", '600px').attr("y", '8px').text("Male Employement Rate").style("font-size", "15px")
  svg.append("text").attr("x", '600px').attr("y", '35px').text("Female Employement Rate").style("font-size", "15px")
  // Parse the Data
  d3.csv("males_data.csv", function(data) {

    var country_values = data.map(function(d) { return d[strUser]});
    var years = data.map(function(d) {return Number(d.Year)})
    const nuevo = country_values.map((i) => Number(i));
    
    var m_max = d3.max(nuevo);
    var max = m_max;

    var temp = d3.csv("females_data.csv", function(data) {
      var country_values = data.map(function(d) { return d[strUser]});
      const nuevo = country_values.map((i) => Number(i));

      var f_max = d3.max(nuevo);

      if (f_max > max){
        max = f_max;
      }
  
      console.log(m_max + "  " + f_max + "  " + max);
    }) 

    console.log(max + "  " + temp);

    // Y axis
    var y = d3.scaleLinear()
      .range([ 60, height ])
      .domain([max, 0.00 ]);
    svg.append("g")
      .call(d3.axisLeft(y));

    for(let i = 0; i < years.length; i++){
      // Lines
      svg.selectAll("myline")
        .data(data)
        .enter()
        .append("line")
          .attr("x1", x(years[i])) 
          .attr("y1", y(0))
          .attr("x2", x(years[i]))
          .attr("y2", y(nuevo[i]))
          .attr("stroke", "blue")
          .attr("stroke-width", 1.5)

      // Circles
      svg.selectAll("mycircle")
        .data(data)
        .enter()
        .append("circle")
          .attr("cx", x(years[i]))
          .attr("cy", y(nuevo[i]))
          .attr("r", "5")
          .style("fill", "blue")
          .attr("stroke", "blue")
      counter = 0;
    }

  d3.csv("females_data.csv", function(data) {

    var country_values = data.map(function(d) { return d[strUser]});
    var years = data.map(function(d) {return Number(d.Year)})
    const nuevo = country_values.map((i) => Number(i));
    
  
    for(let i = 0; i < years.length; i++){
      // Lines
      svg.selectAll("myline")
        .data(data)
        .enter()
        .append("line")
          .attr("x1", x(years[i]) + 7.5) 
          .attr("y1", y(0))
          .attr("x2", x(years[i]) + 7.5)
          .attr("y2", y(nuevo[i]))
          .attr("stroke", "magenta")
          .attr("stroke-width", 1.5)

      // Circles
      svg.selectAll("mycircle")
        .data(data)
        .enter()
        .append("circle")
          .attr("cx", x(years[i]) + 7.5)
          .attr("cy", y(nuevo[i]))
          .attr("r", "5")
          .style("fill", "magenta")
          .attr("stroke", "magenta")
      counter = 0;
    }
  })
  

})}

</script>
